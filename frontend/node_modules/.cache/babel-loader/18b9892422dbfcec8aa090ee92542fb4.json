{"ast":null,"code":"var _jsxFileName = \"/Users/liuyanjun/therapy_agent/frontend/src/MinimalChatTest.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst MinimalChatTest = () => {\n  _s();\n\n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [user, setUser] = useState(null);\n  const [session, setSession] = useState(null);\n  useEffect(() => {\n    // 自动登录\n    login();\n  }, []);\n\n  const login = async () => {\n    try {\n      console.log('开始登录...');\n      const response = await axios.post('http://localhost:5001/api/login', {\n        user_info: {\n          username: 'user1',\n          password: 'ph6n76gec9'\n        }\n      });\n      console.log('登录响应:', response.data);\n\n      if (response.data.success) {\n        setUser(response.data.userID);\n        setSession(response.data.sessionID);\n        setMessages([{\n          id: 1,\n          text: response.data.model_prompt,\n          sender: 'bot'\n        }]);\n      }\n    } catch (error) {\n      console.error('登录失败:', error);\n    }\n  };\n\n  const sendMessage = async () => {\n    if (!inputValue.trim() || !user || !session) return;\n    const userMessage = {\n      id: messages.length + 1,\n      text: inputValue,\n      sender: 'user'\n    };\n    setMessages(prev => [...prev, userMessage]);\n    setInputValue('');\n    setIsLoading(true);\n\n    try {\n      console.log('发送消息:', inputValue);\n      console.log('用户信息:', {\n        user,\n        session\n      });\n      const requestData = {\n        choice_info: {\n          user_id: user,\n          session_id: session,\n          user_choice: inputValue,\n          input_type: ['open_text']\n        }\n      };\n      console.log('请求数据:', requestData);\n      const response = await axios.post('http://localhost:5001/api/update_session', requestData);\n      console.log('收到响应:', response.data);\n\n      if (response.data.chatbot_response) {\n        const botMessage = {\n          id: messages.length + 2,\n          text: response.data.chatbot_response,\n          sender: 'bot'\n        };\n        setMessages(prev => [...prev, botMessage]);\n      }\n    } catch (error) {\n      console.error('发送消息失败:', error);\n      const errorMessage = {\n        id: messages.length + 2,\n        text: `发送失败: ${error.message}`,\n        sender: 'bot'\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleKeyPress = e => {\n    if (e.key === 'Enter' && !isLoading) {\n      sendMessage();\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: '100vh',\n      display: 'flex',\n      flexDirection: 'column',\n      backgroundColor: '#f5f5f5',\n      fontFamily: 'Arial, sans-serif'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '20px',\n        backgroundColor: 'white',\n        boxShadow: '0 2px 4px rgba(0,0,0,0.1)',\n        zIndex: 1000\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"\\uD83E\\uDDEA \\u6700\\u5C0F\\u5316\\u804A\\u5929\\u6D4B\\u8BD5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"\\u8FD9\\u662F\\u4E00\\u4E2A\\u6700\\u5C0F\\u5316\\u7684\\u804A\\u5929\\u7EC4\\u4EF6\\uFF0C\\u7528\\u4E8E\\u6D4B\\u8BD5\\u57FA\\u672C\\u7684API\\u8FDE\\u63A5\\u529F\\u80FD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: '10px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"\\u72B6\\u6001\\u4FE1\\u606F:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: [\"\\u7528\\u6237ID: \", user || '未登录']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [\"\\u4F1A\\u8BDDID: \", session || '无']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [\"\\u6D88\\u606F\\u6570\\u91CF: \", messages.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [\"\\u52A0\\u8F7D\\u72B6\\u6001: \", isLoading ? '加载中' : '空闲']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        flex: 1,\n        padding: '20px',\n        overflow: 'hidden',\n        display: 'flex',\n        flexDirection: 'column'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: 1,\n          overflowY: 'auto',\n          backgroundColor: 'white',\n          borderRadius: '8px',\n          padding: '20px',\n          marginBottom: '20px',\n          boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\n        },\n        children: [messages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            margin: '10px 0',\n            padding: '12px 16px',\n            borderRadius: '18px',\n            maxWidth: '70%',\n            clear: 'both',\n            backgroundColor: message.sender === 'user' ? '#007bff' : '#e9ecef',\n            color: message.sender === 'user' ? 'white' : 'black',\n            marginLeft: message.sender === 'user' ? 'auto' : '0',\n            marginRight: message.sender === 'user' ? '0' : 'auto',\n            wordWrap: 'break-word'\n          },\n          children: message.text\n        }, message.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 13\n        }, this)), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            margin: '10px 0',\n            padding: '12px 16px',\n            borderRadius: '18px',\n            backgroundColor: '#e9ecef',\n            color: 'black',\n            marginLeft: '0',\n            marginRight: '0',\n            width: 'fit-content'\n          },\n          children: \"\\u6B63\\u5728\\u8F93\\u5165...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: '10px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: inputValue,\n          onChange: e => setInputValue(e.target.value),\n          onKeyPress: handleKeyPress,\n          placeholder: \"\\u8F93\\u5165\\u6D88\\u606F...\",\n          disabled: isLoading || !user || !session,\n          style: {\n            flex: 1,\n            padding: '12px 16px',\n            border: '1px solid #ddd',\n            borderRadius: '25px',\n            fontSize: '14px',\n            outline: 'none',\n            backgroundColor: !user || !session ? '#f8f9fa' : 'white'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: sendMessage,\n          disabled: isLoading || !inputValue.trim() || !user || !session,\n          style: {\n            padding: '12px 24px',\n            backgroundColor: '#007bff',\n            color: 'white',\n            border: 'none',\n            borderRadius: '25px',\n            cursor: 'pointer',\n            fontSize: '14px',\n            fontWeight: '500',\n            opacity: isLoading || !inputValue.trim() || !user || !session ? 0.5 : 1\n          },\n          children: \"\\u53D1\\u9001\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this), (!user || !session) && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: '10px',\n          padding: '10px',\n          backgroundColor: '#fff3cd',\n          border: '1px solid #ffeaa7',\n          borderRadius: '4px',\n          color: '#856404',\n          fontSize: '12px'\n        },\n        children: \"\\u6B63\\u5728\\u767B\\u5F55\\u4E2D...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 5\n  }, this);\n};\n\n_s(MinimalChatTest, \"vRpuJHf49Rwhq+4LYsp9jeKKPEU=\");\n\n_c = MinimalChatTest;\nexport default MinimalChatTest;\n\nvar _c;\n\n$RefreshReg$(_c, \"MinimalChatTest\");","map":{"version":3,"sources":["/Users/liuyanjun/therapy_agent/frontend/src/MinimalChatTest.js"],"names":["React","useState","useEffect","axios","MinimalChatTest","messages","setMessages","inputValue","setInputValue","isLoading","setIsLoading","user","setUser","session","setSession","login","console","log","response","post","user_info","username","password","data","success","userID","sessionID","id","text","model_prompt","sender","error","sendMessage","trim","userMessage","length","prev","requestData","choice_info","user_id","session_id","user_choice","input_type","chatbot_response","botMessage","errorMessage","message","handleKeyPress","e","key","height","display","flexDirection","backgroundColor","fontFamily","padding","boxShadow","zIndex","marginTop","flex","overflow","overflowY","borderRadius","marginBottom","map","margin","maxWidth","clear","color","marginLeft","marginRight","wordWrap","width","gap","target","value","border","fontSize","outline","cursor","fontWeight","opacity"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,KAAP,MAAkB,OAAlB;;;AAEA,MAAMC,eAAe,GAAG,MAAM;AAAA;;AAC5B,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BL,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAACM,UAAD,EAAaC,aAAb,IAA8BP,QAAQ,CAAC,EAAD,CAA5C;AACA,QAAM,CAACQ,SAAD,EAAYC,YAAZ,IAA4BT,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM,CAACU,IAAD,EAAOC,OAAP,IAAkBX,QAAQ,CAAC,IAAD,CAAhC;AACA,QAAM,CAACY,OAAD,EAAUC,UAAV,IAAwBb,QAAQ,CAAC,IAAD,CAAtC;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACd;AACAa,IAAAA,KAAK;AACN,GAHQ,EAGN,EAHM,CAAT;;AAKA,QAAMA,KAAK,GAAG,YAAY;AACxB,QAAI;AACFC,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACA,YAAMC,QAAQ,GAAG,MAAMf,KAAK,CAACgB,IAAN,CAAW,iCAAX,EAA8C;AACnEC,QAAAA,SAAS,EAAE;AAAEC,UAAAA,QAAQ,EAAE,OAAZ;AAAqBC,UAAAA,QAAQ,EAAE;AAA/B;AADwD,OAA9C,CAAvB;AAIAN,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBC,QAAQ,CAACK,IAA9B;;AAEA,UAAIL,QAAQ,CAACK,IAAT,CAAcC,OAAlB,EAA2B;AACzBZ,QAAAA,OAAO,CAACM,QAAQ,CAACK,IAAT,CAAcE,MAAf,CAAP;AACAX,QAAAA,UAAU,CAACI,QAAQ,CAACK,IAAT,CAAcG,SAAf,CAAV;AACApB,QAAAA,WAAW,CAAC,CACV;AAAEqB,UAAAA,EAAE,EAAE,CAAN;AAASC,UAAAA,IAAI,EAAEV,QAAQ,CAACK,IAAT,CAAcM,YAA7B;AAA2CC,UAAAA,MAAM,EAAE;AAAnD,SADU,CAAD,CAAX;AAGD;AACF,KAfD,CAeE,OAAOC,KAAP,EAAc;AACdf,MAAAA,OAAO,CAACe,KAAR,CAAc,OAAd,EAAuBA,KAAvB;AACD;AACF,GAnBD;;AAqBA,QAAMC,WAAW,GAAG,YAAY;AAC9B,QAAI,CAACzB,UAAU,CAAC0B,IAAX,EAAD,IAAsB,CAACtB,IAAvB,IAA+B,CAACE,OAApC,EAA6C;AAE7C,UAAMqB,WAAW,GAAG;AAClBP,MAAAA,EAAE,EAAEtB,QAAQ,CAAC8B,MAAT,GAAkB,CADJ;AAElBP,MAAAA,IAAI,EAAErB,UAFY;AAGlBuB,MAAAA,MAAM,EAAE;AAHU,KAApB;AAMAxB,IAAAA,WAAW,CAAC8B,IAAI,IAAI,CAAC,GAAGA,IAAJ,EAAUF,WAAV,CAAT,CAAX;AACA1B,IAAAA,aAAa,CAAC,EAAD,CAAb;AACAE,IAAAA,YAAY,CAAC,IAAD,CAAZ;;AAEA,QAAI;AACFM,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBV,UAArB;AACAS,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqB;AAAEN,QAAAA,IAAF;AAAQE,QAAAA;AAAR,OAArB;AAEA,YAAMwB,WAAW,GAAG;AAClBC,QAAAA,WAAW,EAAE;AACXC,UAAAA,OAAO,EAAE5B,IADE;AAEX6B,UAAAA,UAAU,EAAE3B,OAFD;AAGX4B,UAAAA,WAAW,EAAElC,UAHF;AAIXmC,UAAAA,UAAU,EAAE,CAAC,WAAD;AAJD;AADK,OAApB;AASA1B,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBoB,WAArB;AAEA,YAAMnB,QAAQ,GAAG,MAAMf,KAAK,CAACgB,IAAN,CAAW,0CAAX,EAAuDkB,WAAvD,CAAvB;AAEArB,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBC,QAAQ,CAACK,IAA9B;;AAEA,UAAIL,QAAQ,CAACK,IAAT,CAAcoB,gBAAlB,EAAoC;AAClC,cAAMC,UAAU,GAAG;AACjBjB,UAAAA,EAAE,EAAEtB,QAAQ,CAAC8B,MAAT,GAAkB,CADL;AAEjBP,UAAAA,IAAI,EAAEV,QAAQ,CAACK,IAAT,CAAcoB,gBAFH;AAGjBb,UAAAA,MAAM,EAAE;AAHS,SAAnB;AAKAxB,QAAAA,WAAW,CAAC8B,IAAI,IAAI,CAAC,GAAGA,IAAJ,EAAUQ,UAAV,CAAT,CAAX;AACD;AACF,KA3BD,CA2BE,OAAOb,KAAP,EAAc;AACdf,MAAAA,OAAO,CAACe,KAAR,CAAc,SAAd,EAAyBA,KAAzB;AACA,YAAMc,YAAY,GAAG;AACnBlB,QAAAA,EAAE,EAAEtB,QAAQ,CAAC8B,MAAT,GAAkB,CADH;AAEnBP,QAAAA,IAAI,EAAG,SAAQG,KAAK,CAACe,OAAQ,EAFV;AAGnBhB,QAAAA,MAAM,EAAE;AAHW,OAArB;AAKAxB,MAAAA,WAAW,CAAC8B,IAAI,IAAI,CAAC,GAAGA,IAAJ,EAAUS,YAAV,CAAT,CAAX;AACD,KAnCD,SAmCU;AACRnC,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACD;AACF,GAnDD;;AAqDA,QAAMqC,cAAc,GAAIC,CAAD,IAAO;AAC5B,QAAIA,CAAC,CAACC,GAAF,KAAU,OAAV,IAAqB,CAACxC,SAA1B,EAAqC;AACnCuB,MAAAA,WAAW;AACZ;AACF,GAJD;;AAMA,sBACE;AAAK,IAAA,KAAK,EAAE;AACVkB,MAAAA,MAAM,EAAE,OADE;AAEVC,MAAAA,OAAO,EAAE,MAFC;AAGVC,MAAAA,aAAa,EAAE,QAHL;AAIVC,MAAAA,eAAe,EAAE,SAJP;AAKVC,MAAAA,UAAU,EAAE;AALF,KAAZ;AAAA,4BAOE;AAAK,MAAA,KAAK,EAAE;AACVC,QAAAA,OAAO,EAAE,MADC;AAEVF,QAAAA,eAAe,EAAE,OAFP;AAGVG,QAAAA,SAAS,EAAE,2BAHD;AAIVC,QAAAA,MAAM,EAAE;AAJE,OAAZ;AAAA,8BAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cANF,eAOE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAPF,eAQE;AAAK,QAAA,KAAK,EAAE;AAAEC,UAAAA,SAAS,EAAE;AAAb,SAAZ;AAAA,gCACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAA,kCACE;AAAA,2CAAW/C,IAAI,IAAI,KAAnB;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AAAA,2CAAWE,OAAO,IAAI,GAAtB;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFF,eAGE;AAAA,qDAAWR,QAAQ,CAAC8B,MAApB;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHF,eAIE;AAAA,qDAAW1B,SAAS,GAAG,KAAH,GAAW,IAA/B;AAAA;AAAA;AAAA;AAAA;AAAA,kBAJF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,cARF;AAAA;AAAA;AAAA;AAAA;AAAA,YAPF,eA0BE;AAAK,MAAA,KAAK,EAAE;AACVkD,QAAAA,IAAI,EAAE,CADI;AAEVJ,QAAAA,OAAO,EAAE,MAFC;AAGVK,QAAAA,QAAQ,EAAE,QAHA;AAIVT,QAAAA,OAAO,EAAE,MAJC;AAKVC,QAAAA,aAAa,EAAE;AALL,OAAZ;AAAA,8BAOE;AAAK,QAAA,KAAK,EAAE;AACVO,UAAAA,IAAI,EAAE,CADI;AAEVE,UAAAA,SAAS,EAAE,MAFD;AAGVR,UAAAA,eAAe,EAAE,OAHP;AAIVS,UAAAA,YAAY,EAAE,KAJJ;AAKVP,UAAAA,OAAO,EAAE,MALC;AAMVQ,UAAAA,YAAY,EAAE,MANJ;AAOVP,UAAAA,SAAS,EAAE;AAPD,SAAZ;AAAA,mBASGnD,QAAQ,CAAC2D,GAAT,CAAalB,OAAO,iBACnB;AAAsB,UAAA,KAAK,EAAE;AAC3BmB,YAAAA,MAAM,EAAE,QADmB;AAE3BV,YAAAA,OAAO,EAAE,WAFkB;AAG3BO,YAAAA,YAAY,EAAE,MAHa;AAI3BI,YAAAA,QAAQ,EAAE,KAJiB;AAK3BC,YAAAA,KAAK,EAAE,MALoB;AAM3Bd,YAAAA,eAAe,EAAEP,OAAO,CAAChB,MAAR,KAAmB,MAAnB,GAA4B,SAA5B,GAAwC,SAN9B;AAO3BsC,YAAAA,KAAK,EAAEtB,OAAO,CAAChB,MAAR,KAAmB,MAAnB,GAA4B,OAA5B,GAAsC,OAPlB;AAQ3BuC,YAAAA,UAAU,EAAEvB,OAAO,CAAChB,MAAR,KAAmB,MAAnB,GAA4B,MAA5B,GAAqC,GARtB;AAS3BwC,YAAAA,WAAW,EAAExB,OAAO,CAAChB,MAAR,KAAmB,MAAnB,GAA4B,GAA5B,GAAkC,MATpB;AAU3ByC,YAAAA,QAAQ,EAAE;AAViB,WAA7B;AAAA,oBAYGzB,OAAO,CAAClB;AAZX,WAAUkB,OAAO,CAACnB,EAAlB;AAAA;AAAA;AAAA;AAAA,gBADD,CATH,EAyBGlB,SAAS,iBACR;AAAK,UAAA,KAAK,EAAE;AACVwD,YAAAA,MAAM,EAAE,QADE;AAEVV,YAAAA,OAAO,EAAE,WAFC;AAGVO,YAAAA,YAAY,EAAE,MAHJ;AAIVT,YAAAA,eAAe,EAAE,SAJP;AAKVe,YAAAA,KAAK,EAAE,OALG;AAMVC,YAAAA,UAAU,EAAE,GANF;AAOVC,YAAAA,WAAW,EAAE,GAPH;AAQVE,YAAAA,KAAK,EAAE;AARG,WAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBA1BJ;AAAA;AAAA;AAAA;AAAA;AAAA,cAPF,eAgDE;AAAK,QAAA,KAAK,EAAE;AAAErB,UAAAA,OAAO,EAAE,MAAX;AAAmBsB,UAAAA,GAAG,EAAE;AAAxB,SAAZ;AAAA,gCACE;AACE,UAAA,IAAI,EAAC,MADP;AAEE,UAAA,KAAK,EAAElE,UAFT;AAGE,UAAA,QAAQ,EAAGyC,CAAD,IAAOxC,aAAa,CAACwC,CAAC,CAAC0B,MAAF,CAASC,KAAV,CAHhC;AAIE,UAAA,UAAU,EAAE5B,cAJd;AAKE,UAAA,WAAW,EAAC,6BALd;AAME,UAAA,QAAQ,EAAEtC,SAAS,IAAI,CAACE,IAAd,IAAsB,CAACE,OANnC;AAOE,UAAA,KAAK,EAAE;AACL8C,YAAAA,IAAI,EAAE,CADD;AAELJ,YAAAA,OAAO,EAAE,WAFJ;AAGLqB,YAAAA,MAAM,EAAE,gBAHH;AAILd,YAAAA,YAAY,EAAE,MAJT;AAKLe,YAAAA,QAAQ,EAAE,MALL;AAMLC,YAAAA,OAAO,EAAE,MANJ;AAOLzB,YAAAA,eAAe,EAAG,CAAC1C,IAAD,IAAS,CAACE,OAAX,GAAsB,SAAtB,GAAkC;AAP9C;AAPT;AAAA;AAAA;AAAA;AAAA,gBADF,eAkBE;AACE,UAAA,OAAO,EAAEmB,WADX;AAEE,UAAA,QAAQ,EAAEvB,SAAS,IAAI,CAACF,UAAU,CAAC0B,IAAX,EAAd,IAAmC,CAACtB,IAApC,IAA4C,CAACE,OAFzD;AAGE,UAAA,KAAK,EAAE;AACL0C,YAAAA,OAAO,EAAE,WADJ;AAELF,YAAAA,eAAe,EAAE,SAFZ;AAGLe,YAAAA,KAAK,EAAE,OAHF;AAILQ,YAAAA,MAAM,EAAE,MAJH;AAKLd,YAAAA,YAAY,EAAE,MALT;AAMLiB,YAAAA,MAAM,EAAE,SANH;AAOLF,YAAAA,QAAQ,EAAE,MAPL;AAQLG,YAAAA,UAAU,EAAE,KARP;AASLC,YAAAA,OAAO,EAAGxE,SAAS,IAAI,CAACF,UAAU,CAAC0B,IAAX,EAAd,IAAmC,CAACtB,IAApC,IAA4C,CAACE,OAA9C,GAAyD,GAAzD,GAA+D;AATnE,WAHT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAlBF;AAAA;AAAA;AAAA;AAAA;AAAA,cAhDF,EAqFG,CAAC,CAACF,IAAD,IAAS,CAACE,OAAX,kBACC;AAAK,QAAA,KAAK,EAAE;AACV6C,UAAAA,SAAS,EAAE,MADD;AAEVH,UAAAA,OAAO,EAAE,MAFC;AAGVF,UAAAA,eAAe,EAAE,SAHP;AAIVuB,UAAAA,MAAM,EAAE,mBAJE;AAKVd,UAAAA,YAAY,EAAE,KALJ;AAMVM,UAAAA,KAAK,EAAE,SANG;AAOVS,UAAAA,QAAQ,EAAE;AAPA,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAtFJ;AAAA;AAAA;AAAA;AAAA;AAAA,YA1BF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAgID,CA5ND;;GAAMzE,e;;KAAAA,e;AA8NN,eAAeA,eAAf","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\n\nconst MinimalChatTest = () => {\n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [user, setUser] = useState(null);\n  const [session, setSession] = useState(null);\n\n  useEffect(() => {\n    // 自动登录\n    login();\n  }, []);\n\n  const login = async () => {\n    try {\n      console.log('开始登录...');\n      const response = await axios.post('http://localhost:5001/api/login', {\n        user_info: { username: 'user1', password: 'ph6n76gec9' }\n      });\n      \n      console.log('登录响应:', response.data);\n      \n      if (response.data.success) {\n        setUser(response.data.userID);\n        setSession(response.data.sessionID);\n        setMessages([\n          { id: 1, text: response.data.model_prompt, sender: 'bot' }\n        ]);\n      }\n    } catch (error) {\n      console.error('登录失败:', error);\n    }\n  };\n\n  const sendMessage = async () => {\n    if (!inputValue.trim() || !user || !session) return;\n\n    const userMessage = {\n      id: messages.length + 1,\n      text: inputValue,\n      sender: 'user'\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setInputValue('');\n    setIsLoading(true);\n\n    try {\n      console.log('发送消息:', inputValue);\n      console.log('用户信息:', { user, session });\n      \n      const requestData = {\n        choice_info: {\n          user_id: user,\n          session_id: session,\n          user_choice: inputValue,\n          input_type: ['open_text']\n        }\n      };\n      \n      console.log('请求数据:', requestData);\n      \n      const response = await axios.post('http://localhost:5001/api/update_session', requestData);\n      \n      console.log('收到响应:', response.data);\n      \n      if (response.data.chatbot_response) {\n        const botMessage = {\n          id: messages.length + 2,\n          text: response.data.chatbot_response,\n          sender: 'bot'\n        };\n        setMessages(prev => [...prev, botMessage]);\n      }\n    } catch (error) {\n      console.error('发送消息失败:', error);\n      const errorMessage = {\n        id: messages.length + 2,\n        text: `发送失败: ${error.message}`,\n        sender: 'bot'\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter' && !isLoading) {\n      sendMessage();\n    }\n  };\n\n  return (\n    <div style={{ \n      height: '100vh', \n      display: 'flex', \n      flexDirection: 'column',\n      backgroundColor: '#f5f5f5',\n      fontFamily: 'Arial, sans-serif'\n    }}>\n      <div style={{ \n        padding: '20px', \n        backgroundColor: 'white', \n        boxShadow: '0 2px 4px rgba(0,0,0,0.1)',\n        zIndex: 1000\n      }}>\n        <h1>🧪 最小化聊天测试</h1>\n        <p>这是一个最小化的聊天组件，用于测试基本的API连接功能</p>\n        <div style={{ marginTop: '10px' }}>\n          <strong>状态信息:</strong>\n          <ul>\n            <li>用户ID: {user || '未登录'}</li>\n            <li>会话ID: {session || '无'}</li>\n            <li>消息数量: {messages.length}</li>\n            <li>加载状态: {isLoading ? '加载中' : '空闲'}</li>\n          </ul>\n        </div>\n      </div>\n      \n      <div style={{ \n        flex: 1, \n        padding: '20px',\n        overflow: 'hidden',\n        display: 'flex',\n        flexDirection: 'column'\n      }}>\n        <div style={{\n          flex: 1,\n          overflowY: 'auto',\n          backgroundColor: 'white',\n          borderRadius: '8px',\n          padding: '20px',\n          marginBottom: '20px',\n          boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\n        }}>\n          {messages.map(message => (\n            <div key={message.id} style={{\n              margin: '10px 0',\n              padding: '12px 16px',\n              borderRadius: '18px',\n              maxWidth: '70%',\n              clear: 'both',\n              backgroundColor: message.sender === 'user' ? '#007bff' : '#e9ecef',\n              color: message.sender === 'user' ? 'white' : 'black',\n              marginLeft: message.sender === 'user' ? 'auto' : '0',\n              marginRight: message.sender === 'user' ? '0' : 'auto',\n              wordWrap: 'break-word'\n            }}>\n              {message.text}\n            </div>\n          ))}\n          {isLoading && (\n            <div style={{\n              margin: '10px 0',\n              padding: '12px 16px',\n              borderRadius: '18px',\n              backgroundColor: '#e9ecef',\n              color: 'black',\n              marginLeft: '0',\n              marginRight: '0',\n              width: 'fit-content'\n            }}>\n              正在输入...\n            </div>\n          )}\n        </div>\n        \n        <div style={{ display: 'flex', gap: '10px' }}>\n          <input\n            type=\"text\"\n            value={inputValue}\n            onChange={(e) => setInputValue(e.target.value)}\n            onKeyPress={handleKeyPress}\n            placeholder=\"输入消息...\"\n            disabled={isLoading || !user || !session}\n            style={{\n              flex: 1,\n              padding: '12px 16px',\n              border: '1px solid #ddd',\n              borderRadius: '25px',\n              fontSize: '14px',\n              outline: 'none',\n              backgroundColor: (!user || !session) ? '#f8f9fa' : 'white'\n            }}\n          />\n          <button\n            onClick={sendMessage}\n            disabled={isLoading || !inputValue.trim() || !user || !session}\n            style={{\n              padding: '12px 24px',\n              backgroundColor: '#007bff',\n              color: 'white',\n              border: 'none',\n              borderRadius: '25px',\n              cursor: 'pointer',\n              fontSize: '14px',\n              fontWeight: '500',\n              opacity: (isLoading || !inputValue.trim() || !user || !session) ? 0.5 : 1\n            }}\n          >\n            发送\n          </button>\n        </div>\n        \n        {(!user || !session) && (\n          <div style={{\n            marginTop: '10px',\n            padding: '10px',\n            backgroundColor: '#fff3cd',\n            border: '1px solid #ffeaa7',\n            borderRadius: '4px',\n            color: '#856404',\n            fontSize: '12px'\n          }}>\n            正在登录中...\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default MinimalChatTest;"]},"metadata":{},"sourceType":"module"}