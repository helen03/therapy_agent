{"ast":null,"code":"// MessageParser starter code\nclass MessageParser {\n  constructor(actionProvider, state) {\n    this.actionProvider = actionProvider;\n    this.state = state;\n  } // This method is called inside the chatbot when it receives a message from the user.\n\n\n  parse(message) {\n    // Case: User is already logged in, skip username/password validation\n    if (this.state.userState !== null && this.state.sessionID !== null) {\n      // User is authenticated, proceed with normal message processing\n      let input_type = null;\n\n      if (this.state.inputType && this.state.inputType.length === 1) {\n        input_type = this.state.inputType[0];\n      } else {\n        input_type = this.state.inputType || null;\n      }\n\n      const currentOptionToShow = this.state.currentOptionToShow; // Case: user types when they enter text instead of selecting an option\n\n      if (currentOptionToShow === \"Continue\" && message !== \"Continue\" || currentOptionToShow === \"Emotion\" && message !== \"Happy\" && message !== \"Sad\" && message !== \"Angry\" && message !== \"Neutral\" || currentOptionToShow === \"RecentDistant\" && message !== \"Recent\" && message !== \"Distant\" || currentOptionToShow === \"Feedback\" && message !== \"Better\" && message !== \"Worse\" && message !== \"No change\" || currentOptionToShow === \"Protocol\" && !this.state.protocols.includes(message) || currentOptionToShow === \"YesNo\" && message !== \"Yes\" && message !== \"No\") {\n        this.actionProvider.copyLastMessage();\n      } else {\n        const choice_info = {\n          user_id: this.state.userState,\n          session_id: this.state.sessionID,\n          user_choice: message,\n          input_type: input_type\n        };\n        return this.actionProvider.sendRequest(choice_info);\n      }\n    } else if (this.state.username == null) {\n      // Fallback to asking for username (should not happen in normal flow)\n      return this.actionProvider.askForPassword(message);\n    } else if (this.state.password == null) {\n      // Fallback to asking for password (should not happen in normal flow)\n      return this.actionProvider.updateUserID(this.state.username, message);\n    } else if (this.state.askingForProtocol && parseInt(message) >= 1 && parseInt(message) <= 20) {\n      const choice_info = {\n        user_id: this.state.userState,\n        session_id: this.state.sessionID,\n        user_choice: message,\n        input_type: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]\n      };\n      this.actionProvider.stopAskingForProtocol();\n      return this.actionProvider.sendRequest(choice_info);\n    } else if (this.state.askingForProtocol && (parseInt(message) < 1 || parseInt(message) > 20)) {\n      return this.actionProvider.askForProtocol();\n    } else {\n      let input_type = null;\n\n      if (this.state.inputType && this.state.inputType.length === 1) {\n        input_type = this.state.inputType[0];\n      } else {\n        input_type = this.state.inputType || null;\n      }\n\n      const currentOptionToShow = this.state.currentOptionToShow; // Case: user types when they enter text instead of selecting an option\n\n      if (currentOptionToShow === \"Continue\" && message !== \"Continue\" || currentOptionToShow === \"Emotion\" && message !== \"Happy\" && message !== \"Sad\" && message !== \"Angry\" && message !== \"Neutral\" || currentOptionToShow === \"RecentDistant\" && message !== \"Recent\" && message !== \"Distant\" || currentOptionToShow === \"Feedback\" && message !== \"Better\" && message !== \"Worse\" && message !== \"No change\" || currentOptionToShow === \"Protocol\" && !this.state.protocols.includes(message) || currentOptionToShow === \"YesNo\" && message !== \"Yes\" && message !== \"No\") {\n        this.actionProvider.copyLastMessage();\n      } else {\n        const choice_info = {\n          user_id: this.state.userState,\n          session_id: this.state.sessionID,\n          user_choice: message,\n          input_type: input_type\n        };\n        return this.actionProvider.sendRequest(choice_info);\n      }\n    }\n  }\n\n}\n\nexport default MessageParser;","map":{"version":3,"sources":["/Users/liuyanjun/therapy_agent/frontend/src/MessageParser.js"],"names":["MessageParser","constructor","actionProvider","state","parse","message","userState","sessionID","input_type","inputType","length","currentOptionToShow","protocols","includes","copyLastMessage","choice_info","user_id","session_id","user_choice","sendRequest","username","askForPassword","password","updateUserID","askingForProtocol","parseInt","stopAskingForProtocol","askForProtocol"],"mappings":"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","sourcesContent":["// MessageParser starter code\r\nclass MessageParser {\r\n  constructor(actionProvider, state) {\r\n    this.actionProvider = actionProvider;\r\n    this.state = state;\r\n  }\r\n\r\n  // This method is called inside the chatbot when it receives a message from the user.\r\n  parse(message) {\r\n    // Case: User is already logged in, skip username/password validation\r\n    if (this.state.userState !== null && this.state.sessionID !== null) {\r\n      // User is authenticated, proceed with normal message processing\r\n      let input_type = null;\r\n      if (this.state.inputType && this.state.inputType.length === 1) {\r\n        input_type = this.state.inputType[0]\r\n      } else {\r\n        input_type = this.state.inputType || null\r\n      }\r\n      const currentOptionToShow = this.state.currentOptionToShow\r\n      \r\n      // Case: user types when they enter text instead of selecting an option\r\n      if ((currentOptionToShow === \"Continue\" && message !== \"Continue\") ||\r\n        (currentOptionToShow === \"Emotion\" && (message !== \"Happy\" && message !== \"Sad\" && message !== \"Angry\" && message !== \"Neutral\")) ||\r\n        (currentOptionToShow === \"RecentDistant\" && (message !== \"Recent\" && message !== \"Distant\")) ||\r\n        (currentOptionToShow === \"Feedback\" && (message !== \"Better\" && message !== \"Worse\" && message !== \"No change\")) ||\r\n        (currentOptionToShow === \"Protocol\" && (!this.state.protocols.includes(message))) ||\r\n        (currentOptionToShow === \"YesNo\" && (message !== \"Yes\" && message !== \"No\"))\r\n      ) {\r\n        this.actionProvider.copyLastMessage()\r\n      } else {\r\n        const choice_info = {\r\n          user_id: this.state.userState,\r\n          session_id: this.state.sessionID,\r\n          user_choice: message,\r\n          input_type: input_type,\r\n        };\r\n        return this.actionProvider.sendRequest(choice_info);\r\n      }\r\n    } else if (this.state.username == null) {\r\n      // Fallback to asking for username (should not happen in normal flow)\r\n      return this.actionProvider.askForPassword(message);\r\n    } else if (this.state.password == null) {\r\n      // Fallback to asking for password (should not happen in normal flow)\r\n      return this.actionProvider.updateUserID(this.state.username, message);\r\n    } else if (this.state.askingForProtocol && parseInt(message) >= 1 && parseInt(message) <= 20) {\r\n\r\n      const choice_info = {\r\n        user_id: this.state.userState,\r\n        session_id: this.state.sessionID,\r\n        user_choice: message,\r\n        input_type: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20],\r\n      };\r\n      this.actionProvider.stopAskingForProtocol()\r\n\r\n      return this.actionProvider.sendRequest(choice_info);\r\n    } else if (this.state.askingForProtocol && (parseInt(message) < 1 || parseInt(message) > 20)) {\r\n      return this.actionProvider.askForProtocol()\r\n    }\r\n    else {\r\n      let input_type = null;\r\n      if (this.state.inputType && this.state.inputType.length === 1) {\r\n        input_type = this.state.inputType[0]\r\n      } else {\r\n        input_type = this.state.inputType || null\r\n      }\r\n      const currentOptionToShow = this.state.currentOptionToShow\r\n      // Case: user types when they enter text instead of selecting an option\r\n      if ((currentOptionToShow === \"Continue\" && message !== \"Continue\") ||\r\n        (currentOptionToShow === \"Emotion\" && (message !== \"Happy\" && message !== \"Sad\" && message !== \"Angry\" && message !== \"Neutral\")) ||\r\n        (currentOptionToShow === \"RecentDistant\" && (message !== \"Recent\" && message !== \"Distant\")) ||\r\n        (currentOptionToShow === \"Feedback\" && (message !== \"Better\" && message !== \"Worse\" && message !== \"No change\")) ||\r\n        (currentOptionToShow === \"Protocol\" && (!this.state.protocols.includes(message))) ||\r\n        (currentOptionToShow === \"YesNo\" && (message !== \"Yes\" && message !== \"No\"))\r\n      ) {\r\n        this.actionProvider.copyLastMessage()\r\n      } else {\r\n        const choice_info = {\r\n          user_id: this.state.userState,\r\n          session_id: this.state.sessionID,\r\n          user_choice: message,\r\n          input_type: input_type,\r\n        };\r\n        return this.actionProvider.sendRequest(choice_info);\r\n      }\r\n    }\r\n\r\n  }\r\n}\r\n\r\nexport default MessageParser;\r\n"]},"metadata":{},"sourceType":"module"}